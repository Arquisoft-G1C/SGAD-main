# SGAD ‚Äì Sistema de Gesti√≥n de √Årbitros y Designaciones
<div align="center">
  <img src="docs/logo_text.png" alt="SGAD Logo" width="400">
</div>

---

## üë• Equipo

Grupo **Arquisoft G1C**  
- Wullfredo Javier Barco Godoy ‚Äì wbarco@unal.edu.co  
- Jacel Thom√°s Enciso Pinz√≥n ‚Äì jencisop@unal.edu.co  
- Santiago Nova Acosta ‚Äì snova@unal.edu.co 
- Nombre 4 ‚Äì correo@unal.edu.co  

---

## üìñ Descripci√≥n

El **SGAD (Sistema de Gesti√≥n de √Årbitros y Designaciones)** es una plataforma web distribuida que facilita la **asignaci√≥n imparcial de √°rbitros a partidos deportivos**, la **gesti√≥n administrativa** de √°rbitros y partidos, y el **control de disponibilidad y pagos**.  

Este proyecto corresponde al **Prototype 1** de la materia **Software Architecture (2025-II)**.

---

## üéØ Objetivo del Prototipo

Construir un **prototipo vertical** basado en un dise√±o arquitect√≥nico inicial que permita:  
- Validar el estilo arquitect√≥nico escogido (**microservicios distribuidos con API Gateway**).  
- Demostrar el uso de **distintos lenguajes de programaci√≥n**.  
- Integrar **bases de datos relacional y NoSQL**.  
- Probar el **despliegue en contenedores (Docker)**.  

---

## üìå Requerimientos

### Funcionales
- Registro y consulta de √°rbitros.  
- Gesti√≥n de partidos.  
- Asignaci√≥n de √°rbitros a partidos.  
- Autenticaci√≥n b√°sica de usuarios.  

### No Funcionales
- Arquitectura distribuida con microservicios.  
- 1 componente de presentaci√≥n (frontend web).  
- 2 o m√°s componentes de l√≥gica (gesti√≥n de √°rbitros y partidos).  
- 2 componentes de datos (SQL y NoSQL).  
- 2 tipos de conectores HTTP (REST y GraphQL).  
- 2 lenguajes de programaci√≥n (Python, JavaScript y TypeScript).  
- Despliegue contenerizado (Docker).  

---

## üèóÔ∏è Estructuras Arquitect√≥nicas

### üîπ Diagrama de Componentes y Conectores

![Diagrama C&C](docs/c&c_diagram.png)  

Este diagrama muestra la arquitectura del SGAD organizada en componentes y conectores:

**1. Web Frontend: React + TypeScript**
- **Tipo:** Capa de presentaci√≥n  
- **Responsabilidad:** Interfaz web del sistema SGAD, desde donde los usuarios acceden a las funcionalidades de gesti√≥n de √°rbitros, partidos y autenticaci√≥n.  
- **Tecnolog√≠as:** React (para UI din√°mica) y TypeScript (para tipado y mantenimiento).  
- **Conexiones:**  
  - Env√≠a solicitudes **REST** al *Auth Service* y *Match Management*.  
  - Env√≠a solicitudes **GraphQL** al *Referee Management*.  

**2. Auth Service: Node.js + JWT**
- **Tipo:** Servicio backend  
- **Responsabilidad:** Gestionar autenticaci√≥n y autorizaci√≥n de usuarios.  
- **Tecnolog√≠as:** Node.js con Express y JWT (JSON Web Token).  
- **Funciones principales:**
  - Validaci√≥n de credenciales.  
  - Generaci√≥n y verificaci√≥n de tokens JWT.  
  - Almacenamiento de usuarios en PostgreSQL.  
- **Conexiones:**
  - Recibe peticiones **REST** desde el frontend.  
  - Se comunica mediante **SQL** con SGAD_DB.

**3. Match Management: Python + FastAPI**
- **Tipo:** Servicio backend  
- **Responsabilidad:** Gestionar informaci√≥n de partidos (creaci√≥n, programaci√≥n, resultados, etc.).  
- **Tecnolog√≠as:** Python + FastAPI.  
- **Funciones principales:**
  - API REST para gesti√≥n CRUD de partidos.  
  - Integraci√≥n con PostgreSQL para persistencia de datos.  
- **Conexiones:**
  - Recibe solicitudes **REST** del frontend.  
  - Se comunica con SGAD_DB usando **SQL**.  

**4. Referee Management: Python + FastAPI + GraphQL**
- **Tipo:** Servicio backend especializado  
- **Responsabilidad:** Administraci√≥n de √°rbitros, historial, evaluaciones y certificados.  
- **Tecnolog√≠as:** Python, FastAPI.  
- **Funciones principales:**
  - Guardar datos estructurados de √°rbitros en PostgreSQL.  
  - Almacenar certificados y documentos en MongoDB.  
- **Conexiones:**
  - Recibe solicitudes **GraphQL** del frontend.  
  - Se comunica con SGAD_DB (SQL) y Certificados_DB (NoSQL).
  
**5. SGAD_DB**
- **Tipo:** Base de datos relacional  
- **Responsabilidad:** Almacenar la informaci√≥n estructurada del sistema (usuarios, √°rbitros, partidos).  
- **Tecnolog√≠as:** PostgreSQL 14+.  
- **Conexiones:**  
  - Auth Service (usuarios)  
  - Match Management (partidos)  
  - Referee Management (√°rbitros)
 
**6. Certificados_DB**
- **Tipo:** Base de datos NoSQL  
- **Responsabilidad:** Almacenamiento de certificados y documentos asociados a los √°rbitros.  
- **Tecnolog√≠as:** MongoDB 6+.  
- **Conexiones:**  
  - Exclusivamente con el servicio *Referee Management*.  

**Conectores**

| **Conector** | **Tipo / Protocolo** | **Direcci√≥n** | **Descripci√≥n funcional** |
|---------------|----------------------|----------------|----------------------------|
| Frontend ‚Üí Auth Service | REST (HTTP) | Bidireccional (solicitud/respuesta) | Manejo de login, logout y validaci√≥n de usuarios. |
| Frontend ‚Üí Match Management | REST (HTTP) | Bidireccional | Env√≠o y consulta de informaci√≥n sobre partidos. |
| Frontend ‚Üí Referee Management | GraphQL (HTTP) | Bidireccional | Consultas estructuradas y flexibles sobre √°rbitros y sus datos. |
| Auth Service ‚Üí SGAD_DB | SQL | Unidireccional | Operaciones de lectura/escritura sobre usuarios y credenciales. |
| Match Management ‚Üí SGAD_DB | SQL | Bidireccional | Persistencia de partidos y resultados. |
| Referee Management ‚Üí SGAD_DB | SQL | Bidireccional | Persistencia de datos b√°sicos de √°rbitros. |
| Referee Management ‚Üí Certificados_DB | NoSQL | Bidireccional | Almacenamiento de certificados y documentos. |

---

### üîπ Vista General de la Arquitectura

La vista general muestra el sistema completo en una capa macro. Los **actores externos** (√Årbitro, Club/Equipo, Administrador) interact√∫an con el sistema a trav√©s del **Frontend**. Este se comunica con un **API Gateway** que centraliza el acceso y enruta las peticiones hacia los microservicios internos. Los microservicios (`match-management`, `referee-management`, `auth-service`) a su vez dependen de la infraestructura de datos, conformada por una **base relacional (PostgreSQL)** y una **base NoSQL (MongoDB/Redis)**. Esta vista resume las dependencias y puntos de integraci√≥n del sistema.

![Vista General](docs/Vista%20General%20de%20la%20Arquitectura%20SGAD.JPG)  
Esta vista muestra todo el ecosistema del sistema **SGAD** en un solo diagrama:  
- **Actores externos**: √Årbitro, Club/Equipo y Administrador.  
- **Frontend** como punto de acceso al sistema.  
- **API Gateway** como conector central de los microservicios.  
- **Microservicios**: gesti√≥n de partidos, gesti√≥n de √°rbitros y autenticaci√≥n.  
- **Infraestructura**: bases de datos relacional (SQL) y NoSQL.  

---

### üîπ Vista de Contexto

La vista de contexto representa al sistema **SGAD como una caja negra** en interacci√≥n con su entorno. El **√Årbitro** consulta sus designaciones, el **Club/Equipo** solicita √°rbitros, y el **Administrador** gestiona partidos y recibe reportes. Cada actor utiliza la interfaz del sistema (frontend), sin necesidad de conocer los detalles de implementaci√≥n. Esta vista evidencia el alcance del sistema y sus l√≠mites con respecto a usuarios externos.


![Vista de Contexto](docs/Contexto%20del%20Sistema%20(vista%20de%20alto%20nivel).JPG)  
El sistema se ve como una **caja negra** y se representan las interacciones externas:  
- El **√Årbitro** consulta designaciones.  
- El **Club/Equipo** solicita √°rbitros.  
- El **Administrador** gestiona partidos y recibe reportes y notificaciones.  

---

### üîπ Vista de Despliegue
La vista de despliegue muestra c√≥mo los **contenedores Docker** alojan cada servicio. El **Frontend**, el **API Gateway**, `match-management`, `referee-management`, y `auth-service` se ejecutan como contenedores independientes. Adem√°s, las bases de datos (**PostgreSQL** y **MongoDB**) corren en contenedores separados, facilitando la orquestaci√≥n mediante `docker-compose`. Las relaciones entre nodos se establecen como enlaces de red internos de Docker, lo cual asegura la comunicaci√≥n entre servicios sin exponer puertos innecesarios al exterior.


![Vista de Despliegue](docs/Vista%20de%20Despliegue%20(Deployment).JPG)  
Describe c√≥mo se despliegan los componentes en contenedores Docker:  
- Cada microservicio corre en su propio contenedor.  
- El **API Gateway** intermedia entre frontend y servicios.  
- **PostgreSQL** almacena informaci√≥n de partidos y autenticaci√≥n.  
- **MongoDB** almacena la disponibilidad de √°rbitros y datos no estructurados.  

---

### üîπ Vista de Capas
Su objetivo es mostrar c√≥mo se divide la aplicaci√≥n en niveles funcionales y qu√© capa puede comunicarse con cu√°l, promoviendo la separaci√≥n de responsabilidades y la mantenibilidad.

![Vista de Capas](docs/sgad_capas.PNG)  

**Estructura**

- **Capa de Presentaci√≥n**:
Interact√∫a con el usuario final. Gestiona la interfaz y la comunicaci√≥n con la capa l√≥gica.
  - SGAD-Frontend: React + TypeScript.

- **Capa L√≥gica o de Negocio**:
Contiene la l√≥gica central del sistema, las reglas de negocio y la coordinaci√≥n entre m√≥dulos.
  - Auth Service: (Node.js)
  - Match Management: (FastAPI)
  - Referee Management: (FastAPI)

- **Capa de Datos**:
Administra la persistencia y el acceso a la informaci√≥n.
  - SGAD-DB: PostgreSQL
  - Certificados-DB: MongoDB

---

### üîπ Vista de Descomposici√≥n
La vista de descomposici√≥n muestra c√≥mo el sistema SGAD se divide en m√≥dulos y subm√≥dulos funcionales, representando la estructura jer√°rquica del sistema.

![Vista de Descomposici√≥n](docs/sgad-descomposition-view.PNG)  

**Estructura**

- **Frontend**:  Provee la interfaz de usuario
  - **Web Page**: Provee la interfaz de usuario para la gesti√≥n de √°rbitros, partidos y autenticaci√≥n.

- **Backend**:  Implementar la l√≥gica de negocio del sistema.
  - **Auth Service**: Gestiona registro, login y control de acceso.
  - **Match Management**: Gestiona los partidos y asignaciones.
  - **Referee Management**: Administra √°rbitros y certificados.

- **Capa de Datos**:  Garantizar la persistencia y consistencia de los datos.
  - **SGAD-DB**: Almacena informaci√≥n relacional (usuarios, partidos, √°rbitros).
  - **Certificados-DB**: Almacena documentos y certificaciones de √°rbitros.

---

### üîπ Caso de Uso ‚Äì Asignaci√≥n de √Årbitro

El caso de uso describe el flujo din√°mico de asignaci√≥n de √°rbitros. El **Administrador** solicita la designaci√≥n de un √°rbitro desde el **Frontend**, que env√≠a la petici√≥n al **API Gateway**. Este valida el partido con el **Match Service** y solicita al **Referee Service** la disponibilidad de √°rbitros. El **Referee Service** consulta su base de datos NoSQL y responde con √°rbitros disponibles. El Match Service selecciona uno y devuelve la confirmaci√≥n, que viaja de regreso al administrador. Esta vista ilustra las **interacciones paso a paso** y c√≥mo los microservicios colaboran para resolver un requerimiento funcional clave.


![Caso de Uso](docs/Caso%20de%20uso%20(Asignaci√≥n%20de%20√°rbitro).JPG)  
Representa un escenario din√°mico: la **asignaci√≥n de un √°rbitro a un partido**.  
1. El **Administrador** solicita la designaci√≥n.  
2. El **Frontend** env√≠a la solicitud al **API Gateway**.  
3. El **Match Service** valida el partido.  
4. El **Referee Service** consulta la disponibilidad en la BD.  
5. Se selecciona un √°rbitro disponible y se confirma al administrador.

---

## ‚úÖ Validaci√≥n del Prototipo Vertical

El **Prototype 1** del SGAD implementa un flujo **extremo a extremo (end-to-end)** que permite validar las decisiones arquitect√≥nicas tomadas.  
El flujo seleccionado corresponde al caso de uso central del sistema: **asignaci√≥n de √°rbitro a partido**.

### Flujo vertical implementado

1. **Administrador**  
   - Ingresa al sistema a trav√©s del **Frontend** y solicita la asignaci√≥n de un √°rbitro a un partido espec√≠fico.

2. **Frontend ‚Üí API Gateway**  
   - El frontend env√≠a la solicitud al **API Gateway**, que act√∫a como punto de entrada √∫nico.  
   - El gateway valida la autenticaci√≥n (JWT) mediante el **Auth Service** y enruta la petici√≥n hacia el microservicio correspondiente.

3. **API Gateway ‚Üí Match Service**  
   - El **Match Management Service** recibe la solicitud, valida que el partido exista en la **base de datos relacional (PostgreSQL)** y verifica que pueda asignarse un √°rbitro.

4. **Match Service ‚Üí Referee Service**  
   - Para asignar un √°rbitro, el servicio de partidos consulta al **Referee Management Service**, que mantiene la informaci√≥n de √°rbitros en una **base de datos relacional (PostgreSQL)**.  
   - Se obtiene la lista de √°rbitros disponibles.

5. **Selecci√≥n y confirmaci√≥n**  
   - El **Match Service** selecciona un √°rbitro disponible y registra la designaci√≥n en PostgreSQL.  
   - La respuesta se devuelve al **Frontend** a trav√©s del **API Gateway**.

6. **Administrador visualiza resultado**  
   - El frontend muestra al administrador qu√© √°rbitro fue asignado exitosamente.

---

### üîé Aspectos validados con este flujo

- **Estilo arquitect√≥nico**: uso de microservicios distribuidos coordinados por un API Gateway.  
- **Heterogeneidad tecnol√≥gica**: integraci√≥n de Node.js (gateway/auth/frontend) y Python (match/referee).  
- **Persistencia policroma**: PostgreSQL para datos relacionales (partidos) y MongoDB para datos no estructurados (certificaci√≥n de √°rbitro).  
- **Despliegue contenerizado**: cada servicio corre en su contenedor Docker, orquestados con `docker-compose`.  
- **Comunicaci√≥n REST**: interacci√≥n entre servicios usando HTTP/JSON, incluyendo validaci√≥n con JWT.  

---


## ‚öôÔ∏è Decisiones Arquitect√≥nicas


### 1. Estilo arquitect√≥nico
Se eligi√≥ un estilo de **microservicios distribuidos** con un **API Gateway** al frente.  
Esto permite:  
- Independencia de despliegue y escalabilidad por servicio.  
- Uso de distintos lenguajes y tecnolog√≠as seg√∫n convenga.  
- Aislamiento de fallos y mayor resiliencia.  

### 2. Lenguajes y frameworks
Se emplean **dos lenguajes de programaci√≥n principales** (requisito de la entrega):  

- **JavaScript/TypeScript**  
  - **Frontend**: construido con **React** para ofrecer una interfaz r√°pida, modular y con soporte moderno de ESModules.  
  - **API Gateway y Auth Service**: implementados con **Node.js + Express**, lo que facilita el enrutamiento, la integraci√≥n de middleware y la validaci√≥n de JWT.  

- **Python**  
  - **Match Management Service**: desarrollado con **FastAPI**, ideal por su soporte a documentaci√≥n autom√°tica con Swagger, alto rendimiento (ASGI) y tipado con Pydantic.  
  - **Referee Management Service**: tambi√©n con **FastAPI**, aprovechando la misma pila para simplificar mantenimiento y consistencia en servicios de l√≥gica de negocio.  

### 3. Bases de datos
- **PostgreSQL** ‚Üí usado por `match-management` y `auth-service` para datos relacionales (partidos, usuarios, asignaciones).  
- **MongoDB** ‚Üí usado por `referee-management` para datos din√°micos como certificaci√≥n de √°rbitros.  
- **Redis** (opcional en Prototype 1, pero previsto) ‚Üí soporte para cacheo de tokens, sesiones y colas de notificaciones.  

### 4. Conectores
La comunicaci√≥n se realiza v√≠a **REST sobre HTTP/JSON**.  
- El **API Gateway** es el √∫nico punto expuesto al frontend y aplica seguridad (JWT), rate limiting y logging.  
- Los microservicios exponen endpoints REST internos (`/matches`, `/referees`, `/auth`).  

### 5. Despliegue
- **Docker** se usa para encapsular cada servicio y base de datos en contenedores independientes.  
- **Docker Compose** coordina la infraestructura completa, facilitando el levantamiento del entorno en una sola instrucci√≥n.  
- Esta decisi√≥n asegura que el sistema se pueda desplegar en cualquier entorno con m√≠nima configuraci√≥n.  

---

---
## üé® Estilos arquitect√≥nicos (SGAD)

SGAD adopta un **estilo de microservicios** con **API Gateway** al frente. Cada capacidad de negocio (partidos, √°rbitros, autenticaci√≥n) vive en su propio servicio, se despliega de forma independiente (Docker) y se comunica mediante **REST/HTTP** usando **JSON**.

### ¬øPor qu√© microservicios y no monolito?

**Monolito (descartado para SGAD)**
- Pros: simplicidad inicial, una sola base de c√≥digo, despliegue √∫nico.
- Contras: acoplamiento alto, una falla puede tumbar todo, escalar una parte obliga a escalar todo, barreras para usar m√∫ltiples lenguajes o motores de datos.

**Microservicios (elegido)**
- Se alinean con los **m√≥dulos de negocio** del dominio (partidos, √°rbitros, auth).
- Permiten **tecnolog√≠as heterog√©neas** (p. ej., Python para l√≥gica de negocio; Node.js en gateway/frontend).
- Habilitan **bases de datos policromas**: **PostgreSQL** para datos relacionales y **MongoDB** para disponibilidad/registros no estructurados.
- Soportan **despliegue/escala independiente** por demanda (p. ej., escalar Referee o Match sin tocar los dem√°s).
- Encajan con la necesidad de **entregas incrementales** del curso (Prototype 1, 2, ‚Ä¶).

### Ventajas principales

- **Escalabilidad independiente**: cada servicio escala seg√∫n su carga.
- **Aislamiento de fallas**: una ca√≠da en un servicio no detiene a los dem√°s.
- **Evoluci√≥n tecnol√≥gica**: cambiar framework/BD en un servicio no afecta al resto.
- **Ciclos de despliegue m√°s cortos**: se actualiza solo el servicio modificado.
- **Seguridad y gobierno centralizados** a trav√©s del **API Gateway** (autenticaci√≥n, rate-limiting, logging).

### Trade-offs / Costes

- **Complejidad operacional**: m√°s servicios ‚Üí m√°s orquestaci√≥n/observabilidad.
- **Latencia de red**: llamadas entre servicios agregan hops.
- **Consistencia de datos**: se prefiere **consistencia eventual** entre servicios/BDs.
- **Pruebas de integraci√≥n**: requieren entornos con varios contenedores (Compose).
- **Gesti√≥n de configuraci√≥n**: variables de entorno por servicio (URLs, credenciales).

> C√≥mo mitigamos: Docker Compose para orquestaci√≥n local, **API Gateway** para cross-cutting concerns, endpoints de health (`/health`) y convenciones de contratos REST.

### Comunicaci√≥n (REST sobre HTTP)

- **Patr√≥n**: **Frontend ‚áÜ API Gateway ‚áÜ Microservicios**.  
  El gateway enruta, autentica (JWT), aplica rate-limit y uniformiza respuestas/errores.
- **Formato**: `application/json` en request/response.
- **Verbos y rutas (ejemplos)**  
  - **Match Service**:  
    - `GET /matches`, `GET /matches/{id}`, `POST /matches`, `PUT /matches/{id}`, `DELETE /matches/{id}`
  - **Referee Service**:  
    - `GET /referees`, `GET /referees/{id}`, `POST /referees`, `PUT /referees/{id}`, `GET /referees/available`
  - **Auth Service**:  
    - `POST /auth/login`, `GET /auth/verify`, `GET /auth/profile`
- **Autenticaci√≥n**: JWT en `Authorization: Bearer <token>`; el **gateway** valida y reenv√≠a claims a los servicios.
- **Estados HTTP**: `200/201` ok, `400` solicitud inv√°lida, `401/403` autenticaci√≥n/autorizaci√≥n, `404` no encontrado, `409` conflicto, `500` error interno.
- **Salud/monitoring**:  
  - Gateway: `GET /health`, `GET /health/services`  
  - Servicios: `GET /health` (indica disponibilidad y conexi√≥n a su BD)
- **Descubrimiento/ruteo**: en local, nombres de servicio/puertos definidos en `docker-compose.yml` (p. ej., `match-service:8000`, `referee-service:8000`, `auth-service:3001`).

> Nota: Para notificaciones/colas futuras se considera **Redis** (cache/mensajer√≠a), manteniendo REST como canal principal para Prototype 1.

## üìÇ Estructura del Repositorio

```
sgad-main/
‚îÇ‚îÄ‚îÄ README.md              # Documento principal
‚îÇ‚îÄ‚îÄ docker-compose.yml     # Orquestaci√≥n de microservicios
‚îÇ‚îÄ‚îÄ .env.example           # Variables de entorno de ejemplo
‚îÇ
‚îú‚îÄ‚îÄ docs/                  # Diagramas y documentaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ logo.png
‚îÇ   ‚îú‚îÄ‚îÄ vista_general.jpg
‚îÇ   ‚îú‚îÄ‚îÄ contexto.jpg
‚îÇ   ‚îú‚îÄ‚îÄ cc.jpg
‚îÇ   ‚îú‚îÄ‚îÄ deployment.jpg
‚îÇ   ‚îî‚îÄ‚îÄ caso_uso.jpg
‚îÇ
‚îî‚îÄ‚îÄ scripts/               # Scripts de ayuda (opcional)
    ‚îú‚îÄ‚îÄ start.sh
    ‚îî‚îÄ‚îÄ stop.sh
```

---

## üöÄ Despliegue Local

### 1. Clonar este repositorio
```bash
git clone https://github.com/Arquisoft-G1C/sgad-main.git
cd sgad-main
```

### 2. Configurar variables de entorno
Copiar `.env.example` a `.env` y ajustar credenciales (puertos, BDs, etc.).

### 3. Levantar el sistema
```bash
docker-compose up --build
```

### 4. Acceder al sistema
- **Frontend**: [http://localhost:3000](http://localhost:3000)  
- **Auth Service**: [http://localhost:8000](http://localhost:8000)
- **Match Service**: [http://localhost:8000](http://localhost:8001)
- **Referee Service**: [http://localhost:8000](http://localhost:8002)
- **Postgres**: "5432:5432"
- **Mongo**: "27017:27017"

---

## üîó Microservicios relacionados

- [sgad-frontend](../sgad-frontend)  
- [sgad-api-gateway](../sgad-api-gateway)  
- [sgad-match-management](../sgad-match-management)  
- [sgad-referee-management](../sgad-referee-management)  
- [sgad-auth-service](../sgad-auth-service)  
- [sgad-infrastructure](../sgad-infrastructure)  
